# Writes the value of aws_cli_credentials to aws_cli_dir/aws_cli_credentials_file (default: ~/.aws/credentials)
---
- include_vars:
    file: '{{ item.path }}'
    name: aws_cli_credentials

- debug:
    var: '{{ debug_item }}'
    verbosity: 1
  with_items: [aws_cli_dir, aws_cli_context, aws_cli_credentials]
  loop_control:
    loop_var: debug_item

- name: Template the credentials file
  blockinfile:
    create: yes
    dest: '{{ aws_cli_dir }}/{{ aws_cli_credentials_file }}'
    marker: '# {mark} {{ aws_cli_context }}-{{ key }}'
    block: |
      {% for key, values in aws_cli_credentials.iteritems() %}
      [{{ aws_cli_context | replace('_', '-') }}-{{ key | replace('_', '-') }}]
      aws_access_key_id = {{ values.aws_access_key_id }}
      aws_secret_access_key = {{ values.aws_secret_access_key }}

      {% endfor %}
