---
# Options:
# update: yes; when update is yes then the repo will be refreshed
# version: a specific branch to checkout; default is HEAD

- name: Ensure target directory exists
  file:
    dest: '{{ item.dir }}'
    state: directory
  with_items: '{{ repos }}'

- name: Checkout git repository
  git:
    repo: '{{ item.account }}/{{ item.repo | default(item.name) }}.git'
    dest: '{{ item.dir }}/{{ item.name }}'
    accept_hostkey: yes
    update: no #"{{ item.update | default(0) }}"
    version: "{{ item.branch | default('HEAD') }}"
  with_items: '{{ repos }}'
